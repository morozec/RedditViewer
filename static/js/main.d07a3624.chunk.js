(window["webpackJsonpreddit-viewer-redux"]=window["webpackJsonpreddit-viewer-redux"]||[]).push([[0],{23:function(e,t,r){e.exports=r(38)},28:function(e,t,r){},33:function(e,t,r){},34:function(e,t,r){},37:function(e,t,r){},38:function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"topics",(function(){return k})),r.d(n,"posts",(function(){return L}));var a=r(0),c=r.n(a),o=r(8),i=r.n(o),s=(r(28),r(4)),l=(r(33),r(34),r(2)),u=r.n(l),d=r(5),p=r(1),f=r.n(p),m="topics.TOPICS_FETCHED",h="topics.TOPICS_SELECTED",v="topics.TOPICS_SELECTION_FINILIZED",y=r(9),g=r(10),w=new(function(){function e(){Object(y.a)(this,e)}return Object(g.a)(e,[{key:"getDefaultSubreddits",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,r,n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat("https://www.reddit.com","/subreddits/default.json"),e.next=3,fetch(t,{method:"GET",headers:{Accept:"application/json"}});case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("RedditService getDefaultSubreddits failed, HTTP status ".concat(r.status));case 6:return e.next=8,r.json();case 8:if(n=e.sent,a=f.a.get(n,"data.children")){e.next=12;break}throw new Error("RedditService getDefaultSubreddits failed, children not returned");case 12:return e.abrupt("return",f.a.map(a,(function(e){return{title:f.a.get(e,"data.display_name"),description:f.a.get(e,"data.public_description"),url:f.a.get(e,"data.url")}})));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getPostsFromSubreddit",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var r,n,a,c,o=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat("https://www.reddit.com").concat(t,"hot.json"),e.next=3,fetch(r,{method:"GET",headers:{Accept:"application/json"}});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("RedditService getPostsFromSubreddit failed, HTTP status ".concat(n.status));case 6:return e.next=8,n.json();case 8:if(a=e.sent,c=f.a.get(a,"data.children")){e.next=12;break}throw new Error("RedditService getPostsFromSubreddit failed, children not returned");case 12:return e.abrupt("return",f.a.map(c,(function(e){var r=f.a.get(e,"data.selftext_html");return{id:f.a.get(e,"data.id"),title:f.a.get(e,"data.title"),topicUrl:t,body:r,thumbnail:o._validateUrl(f.a.get(e,"data.thumbnail")),url:r?void 0:o._validateUrl(f.a.get(e,"data.url"))}})));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_validateUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith("http")?e:void 0}}]),e}()),E=r(11),b=r.n(E),I=b()({topicsByUrl:void 0,selectedTopicUrls:[],selectionFinalized:!1});function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case m:return e.merge({topicsByUrl:t.topicsByUrl});case h:return e.merge({selectedTopicUrls:t.selectedTopicUrls});case v:return e.merge({selectionFinalized:!0});default:return e}}var B=function(e){return e.topics.topicsByUrl},S=function(e){return f.a.keys(e.topics.topicsByUrl)},O=function(e){return e.topics.selectedTopicUrls};function j(e){return f.a.mapValues(f.a.keyBy(e.topics.selectedTopicUrls),(function(t){return e.topics.topicsByUrl[t]}))}var T=function(e){return 3===e.topics.selectedTopicUrls.length},x=function(e){return e.topics.selectionFinalized};var C=function(e){return c.a.createElement("ul",null,e.rowsIdArray.map((function(t){return function(e,t,r){return c.a.createElement("li",{key:r},e(r,f.a.get(t,r)))}(e.renderRow,e.rowsById,t)})))},U=function(e){var t=e.selected?"#c0f0ff":"#fff";return c.a.createElement("div",{style:{backgroundColor:t},onClick:function(){e.onClick(e.rowId)}},e.children)},F=Object(s.b)((function(e){return{rowsById:B(e),rowsIdArray:S(e),selectedRowsById:j(e),canFinalizeSelction:T(e)}}))((function(e){console.log(e);var t=e.dispatch;Object(a.useEffect)((function(){console.log("fetch"),t(function(){var e=Object(d.a)(u.a.mark((function e(t,r){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.getDefaultSubreddits();case 3:n=e.sent,a=f.a.keyBy(n,(function(e){return e.url})),t({type:m,topicsByUrl:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}())}),[t]);var r=function(e){var r;t((r=e,function(e,t){var n=O(t());if(-1===f.a.indexOf(n,r)){var a=n.length<3?n.concat(r):n.slice(1).concat(r);e({type:h,selectedTopicUrls:a})}}))};return e.rowsById?c.a.createElement("div",{className:"TopicsScreen"},c.a.createElement("h3",null,"Choose 3 topics of interest"),c.a.createElement(C,{rowsIdArray:e.rowsIdArray,rowsById:e.rowsById,renderRow:function(t,n){var a=e.selectedRowsById[t];return c.a.createElement(U,{rowId:t,onClick:r,selected:a},c.a.createElement("h3",null,n.title),c.a.createElement("p",null,n.description))}}),e.canFinalizeSelction&&c.a.createElement("button",{className:"NextScreen",onClick:function(){t({type:v})}})):(console.log("loading..."),c.a.createElement("p",null,"Loading..."))})),P=r(20),_=(r(37),"posts.POSTS_FETCHED"),N="posts.FILTER_CHANGED",A="posts.POST_SELECTED";var D=b()({postsById:void 0,currentFilter:"all",currentPostId:void 0});function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case _:return e.merge({postsById:t.postsById});case N:return e.merge({currentFilter:t.filter});case A:return e.merge({currentPostId:t.postId});default:return e}}function R(e){return e.posts.currentFilter}function z(e){return f.a.get(e.posts.postsById,e.posts.currentPostId)}var H=function(e){var t=function(t,n){var a=e.selected===t?"selected":void 0;return c.a.createElement("a",{key:t,href:"#",className:a,onClick:function(){return r(t)}},n)},r=function(t,r){t!==r&&e.onChanged(t)};return c.a.createElement("div",{className:e.className},t("all","All"),f.a.map(e.topics,(function(e,r){return t(r,e.title)})))},W=r(21),G=r(18),M=r(22),J=function(e){function t(){return Object(y.a)(this,t),Object(W.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return this.props.post?this.props.post.body?this.renderBody():this._isImage(this.props.post.url)?this.renderImage():this.renderUrl():this.renderEmpty()}},{key:"renderEmpty",value:function(){return c.a.createElement("div",null,c.a.createElement("h3",null,"Select a post to view"))}},{key:"renderBody",value:function(){return c.a.createElement("div",{dangerouslySetInnerHTML:this._getBodyMarkup(this.props.post.body)})}},{key:"renderImage",value:function(){return c.a.createElement("img",{src:this.props.post.url,alt:this.props.post.title})}},{key:"renderUrl",value:function(){return c.a.createElement("div",null,c.a.createElement("h3",null,"External Link"),c.a.createElement("a",{href:this.props.post.url,target:"_blank"},"Open"))}},{key:"_getBodyMarkup",value:function(e){return{__html:e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)})).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}}},{key:"_isImage",value:function(e){return!!e&&(e.endsWith(".jpg")||e.endsWith(".gif")||e.endsWith(".png"))}}]),t}(a.Component),q=Object(s.b)((function(e){var t=function(e){var t=e.posts.currentFilter,r=e.posts.postsById,n="all"===t?f.a.keys(r):f.a.filter(f.a.keys(r),(function(e){return r[e].topicUrl===t}));return[r,n]}(e),r=Object(P.a)(t,2);return{rowsById:r[0],rowIdArray:r[1],topicsByUrl:j(e),currentFilter:R(e),currentPost:z(e)}}))((function(e){var t=e.dispatch;Object(a.useEffect)((function(){t(function(){var e=Object(d.a)(u.a.mark((function e(t,r){var n,a,c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=O(r()),a=f.a.map(n,(function(e){return w.getPostsFromSubreddit(e)})),e.next=5,Promise.all(a);case 5:c=e.sent,o=f.a.keyBy(f.a.flatten(c),(function(e){return e.id})),t({type:_,postsById:o}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}())}),[t]);var r=function(e){t({type:A,postId:e})};return e.rowsById?c.a.createElement("div",{className:"PostsScreen"},c.a.createElement("div",{className:"LeftPane"},c.a.createElement(H,{className:"TopicFilter",topics:e.topicsByUrl,selected:e.currentFilter,onChanged:function(e){t(function(e){return{type:N,filter:e}}(e))}}),c.a.createElement(C,{rowsIdArray:e.rowIdArray,rowsById:e.rowsById,renderRow:function(t,n){var a=e.currentPost===n;return c.a.createElement(U,{rowId:t,onClick:r,selected:a},!!n.thumbnail&&c.a.createElement("img",{className:"thumbnail",src:n.thumbnail,alt:"thumbnail"}),c.a.createElement("h3",null,n.title))}})),c.a.createElement("div",{className:"ContentPane"},c.a.createElement(J,{post:e.currentPost}))):c.a.createElement("p",null,"Loading...")})),V=Object(s.b)((function(e){return{isSelectionFinilized:x(e)}}))((function(e){return c.a.createElement("div",{className:"App"},e.isSelectionFinilized?c.a.createElement(q,null):c.a.createElement(F,null))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Z=r(7),$=r(19),K=Object(Z.d)(Object(Z.c)(n),Object(Z.a)($.a));i.a.render(c.a.createElement(s.a,{store:K},c.a.createElement(V,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[23,1,2]]]);
//# sourceMappingURL=main.d07a3624.chunk.js.map